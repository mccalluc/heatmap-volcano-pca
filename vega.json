{
  "width": 400,
  "height": 400,
  "data": [
    {
      "name": "gene_expression_level",
      "values": [
        {
          "gene": "A",
          "condition": "X",
          "level": 0.5,
          "log_fold_change": -0.1,
          "negative_log_p": 0.1,
          "component_1": 0.1,
          "component_2": 0.1
        },
        {
          "gene": "B",
          "condition": "Y",
          "level": 0.2,
          "log_fold_change": 0,
          "negative_log_p": 0.2,
          "component_1": 0.2,
          "component_2": 0.2
        },
        {
          "gene": "C",
          "condition": "Z",
          "level": 0.7,
          "log_fold_change": 0.1,
          "negative_log_p": 0.1,
          "component_1": 0.14,
          "component_2": 0.16
        }
      ]
    }
  ],
  "signals": [
    {
      "name": "brush_start",
      "init": {},
      "streams": [
        {
          "type": "mousedown",
          "expr": "{x: iscale('x', clamp(eventX(), 0, width)), y: iscale('y', clamp(eventY(), 0, height))}"
        }
      ]
    },
    {
      "name": "brush_end",
      "init": {},
      "streams": [
        {
          "type": "mousedown, [mousedown, window:mouseup] > window:mousemove",
          "expr": "{x: iscale('x', clamp(eventX(), 0, width)), y: iscale('y', clamp(eventY(), 0, height))}"
        }
      ]
    }
  ],
  "marks": [
    {
      "type": "group",
      "properties": {
        "update": {
          "x": {"value": 0},
          "width": {"value": 100},
          "y": {"value": 150},
          "height": {"value": 100}
        }
      },
      "scales": [
        {
          "name": "gene",
          "type": "ordinal",
          "domain": {"data": "gene_expression_level","field": "gene"},
          "range": "width"
        },
        {
          "name": "condition",
          "type": "ordinal",
          "domain": {
            "data": "gene_expression_level",
            "field": "condition"
          },
          "range": "height"
        },
        {
          "name": "level",
          "type": "linear",
          "domain": {"data": "gene_expression_level","field": "level"},
          "range": ["#FFF","#F00"],
          "zero": true
        }
      ],
      "axes": [
        {
          "type": "x",
          "scale": "gene",
          "title": "Genes",
          "tickSize": 0
        },
        {
          "type": "y",
          "scale": "condition",
          "title": "Conditions",
          "tickSize": 0
        }
      ],
      "marks": [
        {
          "type": "rect",
          "from": {"data": "gene_expression_level"},
          "properties": {
            "enter": {
              "x": {"scale": "gene","field": "gene"},
              "width": {"scale": "gene","band": true},
              "y": {"scale": "condition","field": "condition"},
              "height": {"scale": "condition","band": true},
              "fill": {"scale": "level","field": "level"}
            }
          }
        }
      ]
    },
    {
      "type": "group",
      "properties": {
        "update": {
          "x": {"value": 0},
          "width": {"value": 100},
          "y": {"value": 0},
          "height": {"value": 100}
        }
      },
      "scales": [
        {
          "name": "log_fold_change",
          "type": "linear",
          "domain": {
            "data": "gene_expression_level",
            "field": "log_fold_change"
          },
          "range": "width"
        },
        {
          "name": "negative_log_p",
          "type": "linear",
          "domain": {
            "data": "gene_expression_level",
            "field": "negative_log_p"
          },
          "range": "height"
        }
      ],
      "axes": [
        {
          "type": "x",
          "scale": "log_fold_change",
          "title": "log(fold change)",
          "ticks": 3
        },
        {
          "type": "y",
          "scale": "negative_log_p",
          "title": "-log(p)",
          "ticks": 3
        }
      ],
      "marks": [
        {
          "type": "rect",
          "properties": {
            "enter": {
              "fill": {"value": "grey"},
              "fillOpacity": {"value": 0.2}
            },
            "update": {
              "x": {"signal": "brush_start.x"},
              "x2": {"signal": "brush_end.x"},
              "y": {"signal": "brush_start.y"},
              "y2": {"signal": "brush_end.y"}
            }
          }
        },
        {
          "type": "symbol",
          "from": {"data": "gene_expression_level"},
          "properties": {
            "enter": {
              "x": {
                "scale": "log_fold_change",
                "field": "log_fold_change"
              },
              "y": {
                "scale": "negative_log_p",
                "field": "negative_log_p"
              },
              "size": {"value": 20},
              "fill": {"value": "#000"}
            }
          }
        }
      ]
    },
    {
      "type": "group",
      "properties": {
        "update": {
          "x": {"value": 175},
          "width": {"value": 100},
          "y": {"value": 0},
          "height": {"value": 100}
        }
      },
      "scales": [
        {
          "name": "component_1",
          "type": "linear",
          "domain": {
            "data": "gene_expression_level",
            "field": "component_1"
          },
          "range": "width"
        },
        {
          "name": "component_2",
          "type": "linear",
          "domain": {
            "data": "gene_expression_level",
            "field": "component_2"
          },
          "range": "height"
        }
      ],
      "axes": [
        {
          "type": "x",
          "scale": "component_1",
          "title": "Component 1",
          "ticks": 4
        },
        {
          "type": "y",
          "scale": "component_2",
          "title": "Component 2",
          "ticks": 4
        }
      ],
      "marks": [
        {
          "type": "symbol",
          "from": {"data": "gene_expression_level"},
          "properties": {
            "enter": {
              "x": {
                "scale": "component_1",
                "field": "component_1"
              },
              "y": {
                "scale": "component_2",
                "field": "component_2"
              },
              "size": {"value": 20},
              "fill": {"value": "#000"}
            }
          }
        }
      ]
    }
  ]
}
